{% extends "layout.html" %}

{% block head %}
    <script src="{{ url_for('static', filename='js/like.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/comment.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/tags_and_mentions.js') }}" type="text/javascript"></script>
{% endblock %}

{% block body %}
<div class="section container">
    <p class="title is-2 is-spaced">Babbles using #{{ tag }}: </p>
    {% for babble in babbles %}
    <div class="box">
      <article class="media">
        <div class="media-left">
          <figure class="image is-64x64">
              <a href="/babblers/{{ babble.username }}"><img src="{{ url_for('static', filename='images/') }}{{ babble.username }}.jpg" alt="{{ babble.username }}"></a>
          </figure>
        </div>
        <div class="media-content">
          <div class="content">
              <p>
                  <a href="/babblers/{{ babble.username }}"><strong>@{{ babble.username }}</strong></a> <small>{{ babble.elapsed }} ago</small>
                  <br>
                  <div style="white-space: pre-line;" id="linkTags{{ babble.id }}"></div>
                  <script type="text/javascript">
                    document.getElementById("linkTags{{ babble.id }}").innerHTML = link_tags("{{ babble.message }}", {{ babble.tags|safe }});
                  </script>
              </p>
          </div>
          <nav class="level is-mobile">
            <div class="level-left">
              <a class="level-item" onclick="showOrHideCommentArea('{{ babble.id }}', {{ babbles|safe }})">
                <span class="icon is-small"><i class="fas fa-reply"></i></span>
              </a>
              <a class="level-item" onclick="like('{{ babble.id }}')">
                <span class="icon is-small"><i class="fas fa-heart"></i></span>
              </a>
              <p id="like{{ babble.id }}">
                  {{ babble.nbLikes }}
              </p>
              <a id="commentArea{{ babble.id }}" class="level-item"></a>
            </div>
            <div class="level-right">
                <a class="level-item">
                    <span id="has-comment{{ babble.id }}" class="icon is-small" onclick="showHideComments({{ babble }})">
                        <i class="fa fa-ellipsis-h"></i>
                    </span>
                    {% if babble.nbComments == 0 %}
                       <script>
                           hideHasComment({{ babble.id }});
                       </script>
                    {% endif %}
                </a>
            </div>
          </nav>
        </div>
      </article>
      <div id="showComments{{ babble.id }}" style="display: none;"></div>
    </div>
    {% endfor %}
</div>
{% endblock %}